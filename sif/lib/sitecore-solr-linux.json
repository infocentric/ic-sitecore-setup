{
    "Parameters": {
        "SolrUrl": {
            "Type": "string",
            "DefaultValue": "https://localhost:8983/solr",
            "Description": "The Solr instance url."
        },
        "SolrRoot": {
            "Type": "string",
            "DefaultValue": "c:\\solr-7.2.1",
            "Description": "The file path to the Solr instance."
        },
        "SolrService": {
            "Type": "string",
            "DefaultValue": "Solr-7.2.1",
            "Description": "The name of the Solr service."
        },
        "BaseConfig": {
            "Type": "string",
            "DefaultValue": "_default",
            "Description": "The configset to copy as a base for each core."
        },
        "CorePrefix": {
            "Type": "string",
            "DefaultValue": "sitecore",
            "Description": "The prefix for each of the created indexes."
        }
    },
    "Variables": {
        "Solr.FullRoot":    "[resolvepath(parameter('SolrRoot'))]",
        "Solr.Server":      "[joinpath(variable('Solr.FullRoot'), 'server', 'solr')]",
        "Solr.BaseConfigs": "[joinpath(variable('Solr.Server'), 'configsets', parameter('BaseConfig'))]",
        "Solr.SchemaFileName": "managed-schema",
        "Solr.Xpath.SchemaRoot": "//schema",
        "Solr.Xpath.UniqueKey": "[concat(variable('Solr.Xpath.SchemaRoot'), '/uniqueKey')]",
        "Solr.UniqueField" : "_uniqueid",
        "Solr.UniqueField.Attributes": {
            "name" : "[variable('Solr.UniqueField')]",
            "type": "string",
            "indexed": "true",
            "required": "true",
            "stored": "true"
        },

        "Core.Name":        "[concat(parameter('CorePrefix'), '_core_index')]",
        "Master.Name":      "[concat(parameter('CorePrefix'), '_master_index')]",
        "Web.Name":         "[concat(parameter('CorePrefix'), '_web_index')]",
        "MD.Master.Name":   "[concat(parameter('CorePrefix'), '_marketingdefinitions_master')]",
        "MD.Web.Name":      "[concat(parameter('CorePrefix'), '_marketingdefinitions_web')]",
        "MA.Master.Name":   "[concat(parameter('CorePrefix'), '_marketing_asset_index_master')]",
        "MA.Web.Name":      "[concat(parameter('CorePrefix'), '_marketing_asset_index_web')]",
        "Testing.Name":     "[concat(parameter('CorePrefix'), '_testing_index')]",
        "Suggested.Name":   "[concat(parameter('CorePrefix'), '_suggested_test_index')]",
        "FXM.Master.Name":  "[concat(parameter('CorePrefix'), '_fxm_master_index')]",
        "FXM.Web.Name":     "[concat(parameter('CorePrefix'), '_fxm_web_index')]",

        "Core.Root":        "[joinpath(variable('Solr.Server'), variable('Core.Name'))]",
        "Master.Root":      "[joinpath(variable('Solr.Server'), variable('Master.Name'))]",
        "Web.Root":         "[joinpath(variable('Solr.Server'), variable('Web.Name'))]",
        "MD.Master.Root":   "[joinpath(variable('Solr.Server'), variable('MD.Master.Name'))]",
        "MD.Web.Root":      "[joinpath(variable('Solr.Server'), variable('MD.Web.Name'))]",
        "MA.Master.Root":   "[joinpath(variable('Solr.Server'), variable('MA.Master.Name'))]",
        "MA.Web.Root":      "[joinpath(variable('Solr.Server'), variable('MA.Web.Name'))]",
        "Testing.Root":     "[joinpath(variable('Solr.Server'), variable('Testing.Name'))]",
        "Suggested.Root":   "[joinpath(variable('Solr.Server'), variable('Suggested.Name'))]",
        "FXM.Master.Root":  "[joinpath(variable('Solr.Server'), variable('FXM.Master.Name'))]",
        "FXM.Web.Root":     "[joinpath(variable('Solr.Server'), variable('FXM.Web.Name'))]",

        "Core.Conf":        "[joinpath(variable('Core.Root'), 'conf')]",
        "Master.Conf":      "[joinpath(variable('Master.Root'), 'conf')]",
        "Web.Conf":         "[joinpath(variable('Web.Root'), 'conf')]",
        "MD.Master.Conf":   "[joinpath(variable('MD.Master.Root'), 'conf')]",
        "MD.Web.Conf":      "[joinpath(variable('MD.Web.Root'), 'conf')]",
        "MA.Master.Conf":   "[joinpath(variable('MA.Master.Root'), 'conf')]",
        "MA.Web.Conf":      "[joinpath(variable('MA.Web.Root'), 'conf')]",
        "Testing.Conf":     "[joinpath(variable('Testing.Root'), 'conf')]",
        "Suggested.Conf":   "[joinpath(variable('Suggested.Root'), 'conf')]",
        "FXM.Master.Conf":  "[joinpath(variable('FXM.Master.Root'), 'conf')]",
        "FXM.Web.Conf":     "[joinpath(variable('FXM.Web.Root'), 'conf')]",
		
		"Rebuild.Core.Name":        "[concat(parameter('CorePrefix'), '_core_index_rebuild')]",
        "Rebuild.Master.Name":      "[concat(parameter('CorePrefix'), '_master_index_rebuild')]",
        "Rebuild.Web.Name":         "[concat(parameter('CorePrefix'), '_web_index_rebuild')]",
        "Rebuild.MD.Master.Name":   "[concat(parameter('CorePrefix'), '_marketingdefinitions_master_rebuild')]",
        "Rebuild.MD.Web.Name":      "[concat(parameter('CorePrefix'), '_marketingdefinitions_web_rebuild')]",
        "Rebuild.MA.Master.Name":   "[concat(parameter('CorePrefix'), '_marketing_asset_index_master_rebuild')]",
        "Rebuild.MA.Web.Name":      "[concat(parameter('CorePrefix'), '_marketing_asset_index_web_rebuild')]",
        "Rebuild.Testing.Name":     "[concat(parameter('CorePrefix'), '_testing_index_rebuild')]",
        "Rebuild.Suggested.Name":   "[concat(parameter('CorePrefix'), '_suggested_test_index_rebuild')]",
        "Rebuild.FXM.Master.Name":  "[concat(parameter('CorePrefix'), '_fxm_master_index_rebuild')]",
        "Rebuild.FXM.Web.Name":     "[concat(parameter('CorePrefix'), '_fxm_web_index_rebuild')]"
    },
    "Tasks": {
        "CreateCores": {
            "Description": "Tells Solr to create the new cores.",
            "Type": "ManageSolrCore",
            "Params": [
                { "Action": "Create", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('Core.Name')]", "instanceDir": "[variable('Core.Name')]", "configSet": "basic_configs" } },
                { "Action": "Create", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('Master.Name')]", "instanceDir": "[variable('Master.Name')]", "configSet": "basic_configs" } },
                { "Action": "Create", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('Web.Name')]", "instanceDir": "[variable('Web.Name')]", "configSet": "basic_configs" } },
                { "Action": "Create", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('MD.Master.Name')]", "instanceDir": "[variable('MD.Master.Name')]", "configSet": "basic_configs" } },
                { "Action": "Create", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('MD.Web.Name')]", "instanceDir": "[variable('MD.Web.Name')]", "configSet": "basic_configs" } },
                { "Action": "Create", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('MA.Master.Name')]", "instanceDir": "[variable('MA.Master.Name')]", "configSet": "basic_configs" } },
                { "Action": "Create", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('MA.Web.Name')]", "instanceDir": "[variable('MA.Web.Name')]", "configSet": "basic_configs" } },
                { "Action": "Create", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('Testing.Name')]", "instanceDir": "[variable('Testing.Name')]", "configSet": "basic_configs" } },
                { "Action": "Create", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('Suggested.Name')]", "instanceDir": "[variable('Suggested.Name')]", "configSet": "basic_configs" } },
                { "Action": "Create", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('FXM.Master.Name')]", "instanceDir": "[variable('FXM.Master.Name')]", "configSet": "basic_configs" } },
                { "Action": "Create", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('FXM.Web.Name')]", "instanceDir": "[variable('FXM.Web.Name')]", "configSet": "basic_configs" } },
                { "Action": "Create", "Address": "[parameter('SolrUrl')]", "Arguments": { "name": "[variable('Rebuild.Core.Name')]", "instanceDir": "[variable('Rebuild.Core.Name')]", "configSet": "basic_configs" } },
                { "Action": "Create", "Address": "[parameter('SolrUrl')]", "Arguments": { "name": "[variable('Rebuild.Master.Name')]", "instanceDir": "[variable('Rebuild.Master.Name')]", "configSet": "basic_configs" } },
                { "Action": "Create", "Address": "[parameter('SolrUrl')]", "Arguments": { "name": "[variable('Rebuild.Web.Name')]", "instanceDir": "[variable('Rebuild.Web.Name')]", "configSet": "basic_configs" } },
                { "Action": "Create", "Address": "[parameter('SolrUrl')]", "Arguments": { "name": "[variable('Rebuild.MD.Master.Name')]", "instanceDir": "[variable('Rebuild.MD.Master.Name')]", "configSet": "basic_configs" } },
                { "Action": "Create", "Address": "[parameter('SolrUrl')]", "Arguments": { "name": "[variable('Rebuild.MD.Web.Name')]", "instanceDir": "[variable('Rebuild.MD.Web.Name')]", "configSet": "basic_configs" } },
                { "Action": "Create", "Address": "[parameter('SolrUrl')]", "Arguments": { "name": "[variable('Rebuild.MA.Master.Name')]", "instanceDir": "[variable('Rebuild.MA.Master.Name')]", "configSet": "basic_configs" } },
                { "Action": "Create", "Address": "[parameter('SolrUrl')]", "Arguments": { "name": "[variable('Rebuild.MA.Web.Name')]", "instanceDir": "[variable('Rebuild.MA.Web.Name')]", "configSet": "basic_configs" } },
                { "Action": "Create", "Address": "[parameter('SolrUrl')]", "Arguments": { "name": "[variable('Rebuild.Testing.Name')]", "instanceDir": "[variable('Rebuild.Testing.Name')]", "configSet": "basic_configs" } },
                { "Action": "Create", "Address": "[parameter('SolrUrl')]", "Arguments": { "name": "[variable('Rebuild.Suggested.Name')]", "instanceDir": "[variable('Rebuild.Suggested.Name')]", "configSet": "basic_configs" } },
                { "Action": "Create", "Address": "[parameter('SolrUrl')]", "Arguments": { "name": "[variable('Rebuild.FXM.Master.Name')]", "instanceDir": "[variable('Rebuild.FXM.Master.Name')]", "configSet": "basic_configs" } },
                { "Action": "Create", "Address": "[parameter('SolrUrl')]", "Arguments": { "name": "[variable('Rebuild.FXM.Web.Name')]", "instanceDir": "[variable('Rebuild.FXM.Web.Name')]", "configSet": "basic_configs" } }
            ]
        }
    },
    "UninstallTasks": {
        "RemoveCores": {
            "Description": "Removes the cores and instance folders.",
            "Type": "ManageSolrCore",
            "Params": [
                { "Action": "Unload", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('Core.Name')]", "deleteInstanceDir": "true" }, "ErrorAction": "SilentlyContinue" },
                { "Action": "Unload", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('Master.Name')]", "deleteInstanceDir": "true" }, "ErrorAction": "SilentlyContinue" },
                { "Action": "Unload", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('Web.Name')]", "deleteInstanceDir": "true" }, "ErrorAction": "SilentlyContinue" },
                { "Action": "Unload", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('MD.Master.Name')]", "deleteInstanceDir": "true" }, "ErrorAction": "SilentlyContinue" },
                { "Action": "Unload", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('MD.Web.Name')]", "deleteInstanceDir": "true" }, "ErrorAction": "SilentlyContinue" },
                { "Action": "Unload", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('MA.Master.Name')]", "deleteInstanceDir": "true" }, "ErrorAction": "SilentlyContinue" },
                { "Action": "Unload", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('MA.Web.Name')]", "deleteInstanceDir": "true" }, "ErrorAction": "SilentlyContinue" },
                { "Action": "Unload", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('Testing.Name')]", "deleteInstanceDir": "true" }, "ErrorAction": "SilentlyContinue" },
                { "Action": "Unload", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('Suggested.Name')]", "deleteInstanceDir": "true" }, "ErrorAction": "SilentlyContinue" },
                { "Action": "Unload", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('FXM.Master.Name')]", "deleteInstanceDir": "true" }, "ErrorAction": "SilentlyContinue" },
                { "Action": "Unload", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('FXM.Web.Name')]", "deleteInstanceDir": "true" }, "ErrorAction": "SilentlyContinue" },
                { "Action": "Unload", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('Rebuild.Core.Name')]", "deleteInstanceDir": "true" }, "ErrorAction": "SilentlyContinue" },
                { "Action": "Unload", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('Rebuild.Master.Name')]", "deleteInstanceDir": "true" }, "ErrorAction": "SilentlyContinue" },
                { "Action": "Unload", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('Rebuild.Web.Name')]", "deleteInstanceDir": "true" }, "ErrorAction": "SilentlyContinue" },
                { "Action": "Unload", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('Rebuild.MD.Master.Name')]", "deleteInstanceDir": "true" }, "ErrorAction": "SilentlyContinue" },
                { "Action": "Unload", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('Rebuild.MD.Web.Name')]", "deleteInstanceDir": "true" }, "ErrorAction": "SilentlyContinue" },
                { "Action": "Unload", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('Rebuild.MA.Master.Name')]", "deleteInstanceDir": "true" }, "ErrorAction": "SilentlyContinue" },
                { "Action": "Unload", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('Rebuild.MA.Web.Name')]", "deleteInstanceDir": "true" }, "ErrorAction": "SilentlyContinue" },
                { "Action": "Unload", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('Rebuild.Testing.Name')]", "deleteInstanceDir": "true" }, "ErrorAction": "SilentlyContinue" },
                { "Action": "Unload", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('Rebuild.Suggested.Name')]", "deleteInstanceDir": "true" }, "ErrorAction": "SilentlyContinue" },
                { "Action": "Unload", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('Rebuild.FXM.Master.Name')]", "deleteInstanceDir": "true" }, "ErrorAction": "SilentlyContinue" },
                { "Action": "Unload", "Address": "[parameter('SolrUrl')]", "Arguments": { "core": "[variable('Rebuild.FXM.Web.Name')]", "deleteInstanceDir": "true" }, "ErrorAction": "SilentlyContinue" }
            ]
        }
    }
}